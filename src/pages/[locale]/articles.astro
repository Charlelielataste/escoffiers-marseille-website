---
import Layout from "@/layouts/Layout.astro";
import Hero from "@/components/Hero.astro";
import ArticleCard from "@/components/articles/ArticleCard.astro";
import ArticleFilter from "@/components/articles/ArticleFilter.astro";
import FacebookSection from "@/components/articles/FacebookSection.astro";
import MobileFacebookSection from "@/components/articles/MobileFacebookSection.astro";
import ArticlesImage from "@/assets/hero/articles.png";
import { getAllArticles, getSettings } from "@/lib/sanity-queries";
import { urlFor } from "@/lib/sanity";
import type { Locale } from "@/lib/i18n";
import { formatDate } from "@/lib/date";

export function getStaticPaths() {
  return [{ params: { locale: "fr" } }, { params: { locale: "en" } }];
}

const { locale } = Astro.params as { locale: Locale };

const allArticles = await getAllArticles();
const settings = await getSettings();

const featuredArticle = settings?.featuredArticle || allArticles[0];
const hasFeaturedArticle = featuredArticle && allArticles.length > 0;
---

<Layout>
  <Hero picture={ArticlesImage} pictureAlt="Articles">
    <div class="relative z-20 text-center text-white px-4 max-w-4xl mx-auto">
      <h1 class="text-5xl md:text-7xl font-bold mb-6">Articles</h1>
      <h2 class="text-3xl md:text-5xl font-bold mb-8 text-primary">
        Notre Savoir-Faire
      </h2>
      <p class="text-xl md:text-2xl mb-8 max-w-3xl mx-auto leading-relaxed">
        Restez informés de nos dernières actualités, conseils et recettes
      </p>
    </div>
  </Hero>
  <div class="relative px-5 sm:px-10 bg-white py-10">
    <div class="flex flex-col lg:flex-row gap-5 max-w-6xl mx-auto">
      <MobileFacebookSection />
      {
        hasFeaturedArticle ? (
          <ArticleCard
            title={featuredArticle.title[locale]}
            date={formatDate(new Date(featuredArticle.date), locale)}
            image={urlFor(featuredArticle.image).width(600).height(400).url()}
            excerpt={featuredArticle.intro[locale]}
            slug={featuredArticle.slug[locale].current}
            tags={featuredArticle.tags || []}
            is_first={true}
            locale={locale}
          />
        ) : (
          <div class="flex rounded-3xl bg-white shadow-xl w-full h-[540px] border border-tertiary/20 relative">
            <div class="flex flex-col gap-y-2 justify-center items-center w-full">
              <p class="text-center text-primary text-2xl font-bold">
                Aucun article à la une pour le moment
              </p>
              <p class="text-center text-primary text-lg">
                Revenez plus tard pour découvrir nos dernières actualités
              </p>
            </div>
          </div>
        )
      }
      <FacebookSection />
    </div>
    <div class="h-20" id="articles-filter"></div>
    <!-- Filtres et Articles -->
    <ArticleFilter articles={allArticles} locale={locale} />
  </div>
</Layout>

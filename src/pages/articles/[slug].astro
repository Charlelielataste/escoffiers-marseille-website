---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const articles = await getCollection("articles");
  return articles.map((article) => ({
    params: { slug: article.id },
    props: { article },
  }));
}

const { article } = Astro.props;

const allTags = await getCollection("tags");

const findTag = (tags: string[]) => {
  return tags.map((tag) => allTags.find((t) => t.slug === tag));
};

console.log(article.rendered?.html);

// Formater la date en français
const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat("fr-FR", {
    year: "numeric",
    month: "long",
    day: "numeric",
  }).format(date);
};
---

<Layout title={article.data.title}>
  <article class="max-w-6xl mx-auto px-6 py-20">
    <!-- Image en haut -->
    <div class="mb-8">
      <img
        src={article.data.image}
        alt={article.data.title}
        class="w-full h-96 object-cover rounded-2xl shadow-lg"
      />
    </div>

    <!-- Bouton retour -->
    <div class="mb-6">
      <button
        onclick="window.history.back()"
        class="inline-flex items-center text-sm gap-2 bg-primary text-white px-5 py-2 rounded-full font-semibold hover:bg-primary/90 transition-colors duration-200 shadow-md"
      >
        ← Retour aux articles
      </button>
    </div>

    <!-- Date -->
    <div class="mb-6">
      <time
        datetime={article.data.date.toISOString()}
        class="text-gray-600 text-lg font-medium"
      >
        {formatDate(article.data.date)}
      </time>
    </div>

    <!-- Titre -->
    <h1 class="text-4xl md:text-5xl font-bold text-primary mb-8 leading-tight">
      {article.data.title}
    </h1>

    <!-- Tags -->
    <div class="flex flex-wrap gap-3 mb-8">
      {
        findTag(article.data.tags).map((tag) => (
          <span class="bg-secondary text-white py-2 px-4 rounded-full text-sm font-semibold shadow-sm">
            {tag?.data.title}
          </span>
        ))
      }
    </div>

    <!-- Introduction -->
    <div class="mb-12">
      <div
        class="text-xl text-gray-700 leading-relaxed font-medium bg-white p-8 rounded-2xl shadow-sm border border-gray-100"
      >
        {article.data.intro}
      </div>
    </div>

    <!-- Contenu principal -->
    <div
      class="prose prose-lg prose-a:text-blue-500 prose-a:font-bold prose-h1:text-primary prose-h1:font-bold prose-h2:text-primary prose-black max-w-none bg-white p-8 rounded-2xl shadow-sm border border-gray-100"
    >
      <div set:html={article.rendered?.html} />
    </div>
  </article>
</Layout>

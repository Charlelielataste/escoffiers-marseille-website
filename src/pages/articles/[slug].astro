---
import Layout from "@/layouts/Layout.astro";
import { formatDate } from "@/lib/date";
import { getArticleBySlug, getArticleSlugs } from "@/lib/sanity-queries";
import { urlFor } from "@/lib/sanity";
import { PortableText } from "astro-portabletext";
import ArrowLeft from "@/components/icons/ArrowLeft.astro";
import ArticleContent from "@/components/articles/ArticleContent.astro";

export async function getStaticPaths() {
  const articles = await getArticleSlugs();

  return articles.map((article) => ({
    params: {
      slug: article.slug.fr.current,
    },
  }));
}

const { slug } = Astro.params;
const article = await getArticleBySlug(slug!, "fr");

if (!article) {
  return Astro.redirect("/articles");
}

const multilingualSlugs = {
  fr: `/articles/${article.slug.fr.current}/`,
  en: `/en/articles/${article.slug.en.current}/`,
};
---

<Layout title={article.title.fr} multilingualUrls={multilingualSlugs}>
  <ArticleContent article={article} />
</Layout>

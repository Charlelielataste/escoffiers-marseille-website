---
import { formatDateTime } from "@/lib/date";
import { urlFor, type Event } from "@/lib/sanity";
import { PortableText } from "astro-portabletext";
import ArrowLeft from "@/components/icons/ArrowLeft.astro";
import { getTranslations, type Locale } from "@/lib/i18n";
import { Image } from "astro:assets";
export interface Props {
  event: Event;
}
const { event } = Astro.props as Props;

const currentLocale = (Astro.currentLocale || "fr") as Locale;
const t = getTranslations(currentLocale);

const localeTimeFormat = currentLocale === "fr" ? "fr-FR" : "en-US";

const eventPath =
  currentLocale === "fr"
    ? `/evenements/#${event.slug.fr.current}`
    : `/en/events/#${event.slug.en.current}`;
---

<article class="max-w-6xl mx-auto px-6 py-20">
  <div class="mb-6 mt-4">
    <a
      href={eventPath}
      data-astro-reload
      class="inline-flex items-center text-sm gap-3 bg-tertiary text-white px-5 py-2 rounded-full font-semibold transition-all duration-300 transform hover:scale-[1.02] shadow-md"
    >
      <ArrowLeft size={12} class="text-white" />
      <span class="mt-0.5 text-bordered-light">{t.events.backToEvents}</span>
    </a>
  </div>
  <div class="mb-5">
    <Image
      src={urlFor(event.image).width(1200).height(600).url()}
      alt={event.title[currentLocale]}
      class="w-full h-96 object-cover rounded-2xl shadow-lg"
      width={1200}
      height={600}
      loading="eager"
    />
  </div>

  <div class="mb-6">
    <time
      datetime={new Date(event.date).toISOString()}
      class="text-gray-600 text-lg font-bold"
    >
      {formatDateTime(new Date(event.date), localeTimeFormat)}
    </time>
  </div>

  <h1
    class="text-4xl md:text-5xl font-bold text-tertiary-accessible mb-8 leading-tight"
  >
    {event.title[currentLocale]}
  </h1>

  <div class="mb-8">
    <span class="font-semibold">{t.events.location} : </span>
    <a
      href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(event.location)}`}
      target="_blank"
      rel="noopener noreferrer"
      aria-label={t.events.locationLink}
      class="text-primary-accessible font-semibold hover:text-secondary/80 transition-colors duration-200 underline decoration-2 underline-offset-2"
    >
      {event.location}
    </a>
  </div>

  <div class="mb-12">
    <div
      class="text-xl text-gray-700 leading-relaxed font-medium bg-white p-8 rounded-2xl shadow-sm border border-gray-100"
    >
      {event.intro[currentLocale]}
    </div>
  </div>

  {
    new Date(event.date) < new Date() ? (
      <div class="mb-8 flex justify-center">
        <div class="sm:w-[50%] w-[80%] text-center bg-red-800 text-white font-semibold py-3 px-6 rounded-full flex items-center justify-center">
          {t.events.eventEnded}
        </div>
      </div>
    ) : (
      event.link && (
        <div class="mb-8 flex justify-center">
          <a
            href={event.link}
            target="_blank"
            rel="noopener noreferrer"
            class="sm:w-[50%] w-[80%] text-center bg-primary hover:bg-primary/90 text-bordered-light text-white font-semibold py-3 px-6 rounded-full transition-all duration-300 transform hover:scale-[1.02] hover:shadow-lg flex items-center justify-center"
          >
            {t.events.participateToTheEvent}
          </a>
        </div>
      )
    )
  }

  <div
    class="prose prose-lg prose-a:text-blue-500 prose-a:font-bold prose-h1:text-tertiary-accessible prose-h1:font-bold prose-h2:text-tertiary-accessible prose-h3:text-tertiary-accessible prose-black max-w-none bg-white p-5 lg:p-8 rounded-2xl shadow-sm border border-gray-100"
  >
    <PortableText value={event.body[currentLocale]} />
  </div>
</article>

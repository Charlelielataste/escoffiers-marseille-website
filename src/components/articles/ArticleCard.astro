---
import { getTranslations, type Locale } from "@/lib/i18n";
import { cn } from "../../lib/utils";
import { Image } from "astro:assets";
import type { Tag } from "@/lib/sanity";
import ArrowRight from "@/components/icons/ArrowRight.astro";
import StarIcon from "@/components/icons/StarIcon.astro";

export interface Props {
  title: string;
  date: string;
  image: string;
  excerpt: string;
  slug: string;
  is_first?: boolean;
  tags: Tag[];
  locale?: Locale;
}
const {
  title,
  date,
  image,
  excerpt,
  slug,
  is_first = false,
  tags,
  locale = "fr",
} = Astro.props as Props;

const articlePath =
  locale === "fr" ? `/articles/${slug}/` : `/en/articles/${slug}/`;
const t = getTranslations(locale);
---

<div
  id={slug}
  style="scroll-margin-top: 200px;"
  class={cn(
    "flex rounded-3xl bg-white shadow-xl w-full h-full border relative transition-transform duration-300 hover:scale-102",
    is_first ? "lg:h-[540px] border-tertiary/40" : "border-primary/40"
  )}
>
  <a
    href={articlePath}
    aria-label={`${t.articles.readArticle} ${title}`}
    class="w-full p-5"
  >
    {
      is_first && (
        <div class="absolute top-6 left-6 bg-white border border-tertiary/50 text-primary-accessible flex items-center gap-x-2 px-4 py-1 rounded-tl-2xl rounded-br-2xl font-bold z-10">
          <StarIcon size={20} class="shrink-0" />
          <span class="mt-0.5">{t.articles.featuredArticle}</span>
        </div>
      )
    }
    <div class="w-full flex flex-col h-full">
      <Image
        src={image}
        alt={`Illustration de l'article ${title}`}
        loading="lazy"
        width={300}
        height={192}
        class={cn(
          "object-cover w-full h-48 overflow-hidden rounded-2xl mb-4 border",
          is_first ? "lg:h-52 border-tertiary/40" : "border-primary/40"
        )}
      />

      <div class="text-sm text-black mb-3 font-bold">{date}</div>

      <div class="flex flex-wrap gap-2 mb-4">
        {
          tags.map((tag) => (
            <span class="text-black py-1.5 px-3 rounded-full text-xs font-bold bg-secondary/40">
              {tag.title[locale]}
            </span>
          ))
        }
      </div>
      <h3
        class="text-xl md:text-2xl font-bold mb-3 lg:line-clamp-2 text-primary"
      >
        {title}
      </h3>

      <p class="text-gray-700 leading-relaxed line-clamp-4 mb-6">
        {excerpt}
      </p>

      <div class="flex justify-end mt-auto">
        <div
          class="font-bold flex items-center text-sm md:text-base gap-x-2 text-primary-accessible"
        >
          <span>{t.articles.readArticle}</span>
          <ArrowRight size={10} />
        </div>
      </div>
    </div>
  </a>
</div>
